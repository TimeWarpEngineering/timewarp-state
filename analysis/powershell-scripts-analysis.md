# PowerShell Scripts Analysis Report

## Executive Summary
This repository contains **19 PowerShell scripts** (excluding Playwright auto-generated scripts). The analysis reveals that **11 scripts** require migration to C# using TimeWarp.Nuru and TimeWarp.Amuru, while **8 scripts** are auto-generated by Playwright and should be excluded from migration.

**Critical Finding**: Task 035 is missing GitHub workflow scripts (`.github/workflows/*.ps1`) which are actively used in CI/CD pipelines and must be included in the migration plan.

## Script Inventory and Analysis

### 1. GitHub Workflow Scripts (MISSING FROM TASK 035 ⚠️)

#### `.github/workflows/build.ps1`
- **Purpose**: Orchestrates the build process for GitHub Actions
- **Key Functions**: 
  - Lists installed .NET SDKs
  - Restores dotnet tools
  - Creates local NuGet feed directory
  - Builds TimeWarp.State.Analyzer and SourceGenerator
  - Builds and packs TimeWarp.State and TimeWarp.State.Plus
- **Dependencies**: `common.ps1` for shared functions
- **Used By**: `ci-build.yml`, `master-build.yml`, `publish-documentation.yml`
- **Migration Priority**: HIGH - Critical for CI/CD
- **Recommendation**: MIGRATE to C# console app using TimeWarp.Amuru

#### `.github/workflows/test.ps1`
- **Purpose**: Runs all test suites in the repository
- **Key Functions**:
  - Builds and runs analyzer tests
  - Builds and runs state tests
  - Builds and runs plus tests
  - Runs client integration tests
  - Runs architecture tests
- **Dependencies**: `common.ps1` for shared functions  
- **Used By**: `ci-build.yml`, `master-build.yml`
- **Migration Priority**: HIGH - Critical for CI/CD
- **Recommendation**: MIGRATE to C# console app using TimeWarp.Amuru

#### `.github/workflows/common.ps1`
- **Purpose**: Shared utility functions for workflow scripts
- **Key Functions**:
  - `Invoke-CommandWithExit`: Executes commands and exits on error
  - Environment variable validation
- **Used By**: `build.ps1`, `test.ps1`
- **Migration Priority**: HIGH - Dependency for other workflow scripts
- **Recommendation**: MIGRATE to shared C# library

#### `.github/scripts/sync-configurable-files.ps1`
- **Purpose**: Synchronizes configuration files from parent repositories
- **Key Functions**:
  - Downloads files from GitHub repositories via API
  - Manages YAML configuration parsing (installs yq if needed)
  - Handles file comparison and updates
  - Manages workflow file permissions with SYNC_PAT
- **Size**: 444 lines - Complex script
- **Used By**: `sync-configurable-files.yml`
- **Migration Priority**: MEDIUM - Important for repo maintenance
- **Recommendation**: MIGRATE to C# with careful attention to GitHub API interactions

### 2. Root Directory Build Scripts

#### `build-nugets.ps1`
- **Purpose**: Builds all NuGet packages for the solution
- **Key Functions**:
  - Clears NuGet caches
  - Cleans solution
  - Creates local NuGet feed
  - Builds all projects in sequence
- **Migration Priority**: HIGH
- **Recommendation**: MIGRATE - Core build functionality

#### `build-and-package-analyzer.ps1` 
- **Purpose**: Builds and packages the analyzer with local testing
- **Key Functions**:
  - Builds analyzer and source generator
  - Creates NuGet packages
  - Manages local NuGet source
  - Tests analyzer with sample project
- **Migration Priority**: MEDIUM
- **Recommendation**: MIGRATE - Important for analyzer development

### 3. Test Runner Scripts

#### `run-e2e-tests.ps1`
- **Purpose**: Comprehensive end-to-end test runner
- **Key Functions**:
  - Manages test environment setup
  - Builds and publishes SUT (System Under Test)
  - Installs Playwright browsers
  - Runs E2E tests with logging
  - Supports multiple run modes (Auto, Manual, Development, Release)
- **Size**: 376 lines - Most complex script
- **Migration Priority**: HIGH
- **Recommendation**: MIGRATE - Critical testing infrastructure

#### `run-tests.ps1`
- **Purpose**: Simple test runner for unit tests
- **Key Functions**:
  - Lists LocalNugetFeed contents
  - Restores packages
  - Builds analyzer tests
  - Runs Fixie tests for all test projects
- **Migration Priority**: MEDIUM
- **Recommendation**: MIGRATE - Important for local development

#### `run-test-app.ps1`
- **Purpose**: Launches test application for manual testing
- **Key Functions**:
  - Sets development environment
  - Builds analyzer and source generator
  - Runs test app server
- **Migration Priority**: LOW
- **Recommendation**: MIGRATE - Development utility

### 4. Utility Scripts

#### `convert-timestamp.ps1`
- **Purpose**: Converts Git commit timestamps to human-readable dates
- **Key Functions**:
  - Used in MSBuild tasks
  - Converts Unix timestamps to formatted dates
- **Migration Priority**: LOW
- **Recommendation**: MIGRATE - Build process utility

#### `cline.ps1`
- **Purpose**: Concatenates AI context files for Cline tool
- **Key Functions**:
  - Merges multiple .ai/*.md files
  - Creates .clinerules file
- **Migration Priority**: LOW
- **Recommendation**: CONSIDER REMOVAL - May be obsolete

### 5. Documentation Scripts

#### `scripts/build-readme.ps1`
- **Purpose**: Generates README.md from partial markdown files
- **Key Functions**:
  - Removes YAML front matter
  - Concatenates documentation partials
  - Creates unified README
- **Migration Priority**: LOW
- **Recommendation**: MIGRATE - Documentation maintenance

### 6. Sample Scripts

#### `samples/03-routing/wasm/sample-03-wasm/run.ps1`
- **Purpose**: Runs sample application
- **Status**: Not examined in detail
- **Migration Priority**: LOW
- **Recommendation**: MIGRATE - Sample consistency

### 7. Auto-Generated Scripts (EXCLUDE FROM MIGRATION)

All scripts in `tests/test-app-end-to-end-tests/bin/Debug/net9.0/` are generated by Playwright:
- `playwright.ps1` - Main Playwright script
- `.playwright/package/bin/*.ps1` - Browser installation scripts (6 files)

**Recommendation**: EXCLUDE - These are managed by Playwright

## Migration Strategy

### Phase 1: Critical Infrastructure (HIGH Priority)
1. **Create shared library** for common functions (from `common.ps1`)
2. **Migrate workflow scripts**:
   - `.github/workflows/build.ps1` → `TimeWarp.State.Build`
   - `.github/workflows/test.ps1` → `TimeWarp.State.Test`
   - `.github/workflows/common.ps1` → Shared library
3. **Migrate E2E test runner**:
   - `run-e2e-tests.ps1` → `TimeWarp.State.E2ETestRunner`

### Phase 2: Build Tools (MEDIUM Priority)
4. **Migrate build scripts**:
   - `build-nugets.ps1` → `TimeWarp.State.BuildNugets`
   - `build-and-package-analyzer.ps1` → `TimeWarp.State.BuildAnalyzer`
5. **Migrate test runners**:
   - `run-tests.ps1` → `TimeWarp.State.TestRunner`

### Phase 3: Utilities (LOW Priority)
6. **Migrate utilities**:
   - `convert-timestamp.ps1` → `TimeWarp.State.TimestampConverter`
   - `scripts/build-readme.ps1` → `TimeWarp.State.BuildReadme`
   - `run-test-app.ps1` → `TimeWarp.State.RunTestApp`
7. **Migrate sample runners**:
   - Sample run scripts → Individual sample runners

### Phase 4: Complex Scripts
8. **Migrate sync script**:
   - `.github/scripts/sync-configurable-files.ps1` → `TimeWarp.State.SyncConfig`
   - Requires careful handling of GitHub API interactions
   - Consider using Octokit.NET for GitHub API

## Technical Considerations

### TimeWarp.Amuru Usage Patterns
```csharp
// For dotnet commands
await DotNet.Build()
    .WithProject("./source/timewarp-state/")
    .WithConfiguration("Release")
    .ExecuteAsync();

// For git commands
await Git.Add()
    .WithPath(".")
    .ExecuteAsync();

// For generic shell commands
await Shell.Run("pwsh")
    .WithArguments("-Command", "Get-ChildItem")
    .ExecuteAsync();
```

### TimeWarp.Nuru CLI Structure
```csharp
var app = NuruApp.Create(args);

app.Command("build", "Build the solution", async (string configuration = "Release") =>
{
    // Implementation
});

await app.RunAsync();
```

## Recommendations

1. **Update Task 035**: Add the missing GitHub workflow scripts to the migration task
2. **Create Project Structure**: 
   - `/tools/` directory for all migrated tools
   - Shared library project for common functionality
3. **Maintain Compatibility**: Keep PowerShell scripts during transition
4. **Update CI/CD**: Gradually transition workflows to use C# tools
5. **Consider Removal**: Evaluate if `cline.ps1` is still needed

## Scripts NOT Requiring Migration
- All Playwright-generated scripts (8 files)
- These are managed by the Playwright package and regenerated as needed

## Total Migration Scope
- **Scripts to Migrate**: 11
- **Scripts to Exclude**: 8 (Playwright)
- **Lines of PowerShell to Convert**: ~1,500+
- **Estimated Effort**: 2-3 weeks for complete migration

## Next Steps
1. Update Task 035 to include workflow scripts
2. Create `/tools/` directory structure
3. Begin Phase 1 migration with critical infrastructure
4. Test migrated tools in parallel with existing scripts
5. Update documentation and CI/CD pipelines